- name: Prepare virtual network configuration
  set_fact:
    vnet: "{{ smiths_config_networking[smiths_subscription].virtual_networks[smiths_vnet] | combine({'name': smiths_vnet}) }}"

- name: Prepare virtual network tags
  set_fact:
    vnet_tags: "{{ smiths_config_tag_presets[vnet.metadata.preset] | combine(vnet.metadata.additional_tags) }}"

- name: Prepare virtual network template
  set_fact:
    vnet_template: "{{ lookup('template', 'virtual-network.yml.j2') | from_yaml }}"

- name: Print virtual network template
  debug:
    var: vnet_template
    verbosity: 4

- name: Execute virtual network template
  include_role:
    name: deploy
  vars:
    deployment: "{{ vnet_template }}"